<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<div id="container" class="clear">
	<div id="games-left-column">
		<div id="user1-turn" class="circle">HIDE?</div>
		<div class="user1-info">
			<div class="text-center">User 1</div>
			<div>
				<div class="pull-left">
					Wins: 5
					<br>
					Losses: 5
				</div>
				<div class="pull-right">
					IMAGE
				</div>
			</div>
			<div class="clear text-center">Waiting on User 2</div>
		</div>
		<div class="text-center">
			<br>
			<button class="btn btn-warning">Declare Stalemate</button>
			<br>
			<br>
			<button class="btn btn-danger">Surrender</button>
			<br>
			<br>
			<hr>
			<h2>Countdown</h2>
			<br>
			<br>
			<h1>5:00</h1>
		</div>
	</div>

	<div id="games-center-column">
		<div id="score-board">
			<div class="pull-left">
				W: 2
				<br>
				L: 0
			</div>

			<div class="pull-left">
				User 1 vs User 2
			</div>

			<div class="pull-right">
				W: 0
				<br>
				L: 2
			</div>
		</div>

		<script>
			update_url = undefined;
			var original_position = '';
			$(function() {
				$('.piece').on ("mousedown", function() {
					update_url = $(this).attr('data-update-url');

				});

				$('.piece').draggable({
					containment: "#board",
					snap: ".square",
					 start: function( event, ui ) {
						original_position = ui.position;
					}
				});

				$('.square').droppable({
					hoverClass: "highlighted",
					drop: function(event, ui) {


		            	$.ajax({
		            		type: 'PUT',
		            		beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
		            		url: update_url,
		            		dataType: 'html',
		            		data: { piece: { x_position: $(this).attr('data-item-x'), y_position: $(this).attr('data-item-y') } },
						    error: function(){
				               $(ui.draggable).css({
				                  'left': original_position.left,
				                  'top': original_position.top,
				               }),

				               alert('You cant take your own piece!');
				           	},
				           	success: function(){
				            	window.location.reload();
				            }
		            	});
		        	}
				});
			});
		</script>


		<div id="board">
			<%= render "draw_pieces"%>
		</div>
		<br>
		<% if flash[:error].present? %>
	      <div class="col-xs-10 col-xs-offset-1 alert alert-danger text-center">
	        <%= flash[:error] %>
	      </div>
	    <% elsif flash[:notice].present? %>
	    <div class="col-xs-10 col-xs-offset-1 alert alert-danger text-center">
	        <%= flash[:notice] %>
	      </div>
   		<% end %>

	</div>

	<div id="games-right-column">
		<div id="user2-turn" class="circle">TURN</div>
		<div class="user2-info">
			<div class="text-center">User 2</div>
			<div>
				<div class="pull-left">
					Wins: 1
					<br>
					Losses: 8
				</div>
				<div class="pull-right">
					IMAGE
				</div>
			</div>
			<div class="clear text-center">Waiting on User 2</div>
		</div>
		<div class="text-center">
			<br>
			<button class="btn btn-warning">Declare Stalemate</button>
			<br>
			<br>
			<button class="btn btn-danger">Surrender</button>
			<br>
			<br>
			<hr>
			<h2>Countdown</h2>
			<br>
			<br>
			<h1 class="text-success">3:30</h1>
		</div>
	</div>
</div>
